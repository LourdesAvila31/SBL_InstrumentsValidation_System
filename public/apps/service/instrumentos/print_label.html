<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Imprimir etiqueta | Portal de servicio</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <base id="app-base" href="/">
    <script>
        (function () {
            var baseTag = document.getElementById('app-base');
            if (!baseTag) {
                return;
            }
            var pathname = window.location && typeof window.location.pathname === 'string'
                ? window.location.pathname
                : '';
            var baseHref = '';
            var publicIndex = pathname.indexOf('/public/');
            if (publicIndex !== -1) {
                baseHref = pathname.slice(0, publicIndex + 7);
            } else if (pathname.endsWith('/public')) {
                baseHref = pathname;
            } else {
                baseHref = '/public';
            }
            if (!baseHref) {
                baseHref = '/public';
            }
            if (!baseHref.endsWith('/')) {
                baseHref += '/';
            }
            baseTag.setAttribute('href', baseHref);
            var globalBase = baseHref.replace(/\/+$/, '');
            if (!globalBase) {
                globalBase = '/public';
            }
            window.BASE_URL = globalBase;
            window.AppUrl = window.AppUrl || {};
            if (typeof window.AppUrl.BASE_URL !== 'string' || !window.AppUrl.BASE_URL) {
                window.AppUrl.BASE_URL = globalBase;
            }
        })();
    </script>
    <script src="assets/scripts/base-url.js" defer></script>
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            var baseTag = document.getElementById('app-base');
            if (!baseTag) {
                return;
            }
            var href = (typeof window.BASE_URL === 'string' && window.BASE_URL) ? window.BASE_URL : '/public';
            if (!href.endsWith('/')) {
                href += '/';
            }
            baseTag.setAttribute('href', href);
        });
    </script>
  
    <!-- Estilos alineados al portal de servicio -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/styles/service.css">
    <style>
        body {
            background: #f0f5f5;
            font-family: 'Montserrat', Arial, sans-serif;
            margin: 0;
            padding: 18px;
        }
        .label-wrapper {
            max-width: 520px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 14px;
            border: 1px solid #d6e4e4;
            padding: 28px 30px;
            box-shadow: 0 12px 32px rgba(13, 87, 90, 0.18);
        }
        .label-header {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 18px;
        }
        .label-header h1 {
            font-size: 1.5rem;
            color: #0d575a;
            font-weight: 700;
            margin: 0;
        }
        .label-header .identifier {
            font-size: 0.95rem;
            color: #0c8c98;
        }
        .label-info {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }
        .info-item {
            font-size: 0.95rem;
            color: #2f4f50;
        }
        .info-item strong {
            display: block;
            margin-bottom: 4px;
            color: #0d575a;
            font-size: 0.82rem;
            letter-spacing: 0.02em;
        }
        .qr-section {
            display: flex;
            justify-content: center;
            padding: 14px 0 18px;
        }
        #qrContainer {
            width: 180px;
            height: 180px;
        }
        .link-section {
            font-size: 0.85rem;
            word-break: break-word;
            color: #0c8c98;
        }
        .print-actions {
            display: flex;
            justify-content: center;
            margin-top: 22px;
        }
        #labelStatus {
            margin-top: 18px;
            font-size: 0.9rem;
            text-align: center;
            color: #0d575a;
        }
        #labelStatus[data-type="error"] {
            color: #c53030;
        }
        #labelStatus.hidden {
            display: none;
        }
        @media print {
            body {
                background: #ffffff;
                padding: 0;
            }
            .label-wrapper {
                box-shadow: none;
                border: none;
                margin: 0;
                width: 100%;
                max-width: none;
                padding: 12mm;
            }
            .print-actions,
            #labelStatus {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="label-wrapper">
        <div class="label-header">
            <h1 id="labelName">Instrumento</h1>
            <div id="labelIdentifier" class="identifier">ID</div>
        </div>
        <div class="label-info">
            <div class="info-item">
                <strong>Ubicación</strong>
                <span id="labelLocation">Sin ubicación</span>
            </div>
            <div class="info-item">
                <strong>Departamento</strong>
                <span id="labelDepartment">Sin departamento</span>
            </div>
            <div class="info-item">
                <strong>Último certificado</strong>
                <span id="labelIssuedAt">-</span>
            </div>
            <div class="info-item">
                <strong>Vigencia</strong>
                <span id="labelExpiresAt">-</span>
            </div>
        </div>
        <div class="qr-section">
            <div id="qrContainer" aria-label="Código QR del certificado"></div>
        </div>
        <div class="link-section">
            <strong>Certificado:</strong>
            <a id="labelCertificateLink" href="#" target="_blank" rel="noopener">Cargando…</a>
        </div>
        <div class="print-actions">
            <button id="printLabelButton" class="btn btn-primary">Imprimir</button>
        </div>
        <div id="labelStatus" class="hidden" data-type="info"></div>
    </div>
    <script type="module" src="assets/scripts/scripts-service.js"></script>
    <script src="assets/scripts/vendor/qrcode.min.js"></script>
    <script src="assets/scripts/labels.js"></script>
</body>
</html>
