<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAMP 5 - Sistema de Administración</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.min.css" rel="stylesheet">
    <style>
        :root {
            --gamp-primary: #2c5aa0;
            --gamp-secondary: #34495e;
            --gamp-success: #27ae60;
            --gamp-warning: #f39c12;
            --gamp-danger: #e74c3c;
            --gamp-info: #3498db;
            --gamp-light: #ecf0f1;
            --gamp-dark: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }

        .navbar-brand {
            font-weight: bold;
            color: var(--gamp-primary) !important;
        }

        .nav-pills .nav-link {
            color: var(--gamp-secondary);
            margin-right: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .nav-pills .nav-link.active {
            background-color: var(--gamp-primary);
        }

        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            margin-bottom: 1.5rem;
        }

        .card-header {
            background-color: var(--gamp-light);
            border-bottom: 1px solid #dee2e6;
            font-weight: 600;
        }

        .metric-card {
            text-align: center;
            padding: 1.5rem;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--gamp-primary);
        }

        .metric-label {
            color: var(--gamp-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active { background-color: var(--gamp-success); }
        .status-warning { background-color: var(--gamp-warning); }
        .status-critical { background-color: var(--gamp-danger); }
        .status-inactive { background-color: #95a5a6; }

        .compliance-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
        }

        .badge-compliant {
            background-color: var(--gamp-success);
            color: white;
        }

        .badge-non-compliant {
            background-color: var(--gamp-danger);
            color: white;
        }

        .badge-pending {
            background-color: var(--gamp-warning);
            color: white;
        }

        .activity-item {
            padding: 0.75rem;
            border-left: 3px solid var(--gamp-info);
            margin-bottom: 0.5rem;
            background-color: white;
            border-radius: 0 0.375rem 0.375rem 0;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .alert-item {
            border-left: 4px solid var(--gamp-warning);
            padding: 1rem;
            background-color: #fff8f0;
            margin-bottom: 0.5rem;
        }

        .alert-critical {
            border-left-color: var(--gamp-danger);
            background-color: #fdf2f2;
        }

        .kpi-progress {
            height: 8px;
            border-radius: 4px;
            background-color: #e9ecef;
            overflow: hidden;
        }

        .kpi-progress-bar {
            height: 100%;
            background-color: var(--gamp-success);
            transition: width 0.3s ease;
        }

        .module-nav {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        .btn-gamp {
            background-color: var(--gamp-primary);
            border-color: var(--gamp-primary);
            color: white;
        }

        .btn-gamp:hover {
            background-color: #1e3d6f;
            border-color: #1e3d6f;
            color: white;
        }

        .table-hover tbody tr:hover {
            background-color: #f8f9fa;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .system-health {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .gxp-compliance-indicator {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
        }

        .compliance-score {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        @media (max-width: 768px) {
            .metric-value {
                font-size: 2rem;
            }
            
            .module-nav {
                text-align: center;
            }
            
            .nav-pills {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-shield-alt"></i>
                GAMP 5 Sistema de Administración
            </a>
            <div class="navbar-nav ms-auto">
                <span class="nav-link">
                    <i class="fas fa-user"></i>
                    <span id="current-user">Usuario</span>
                </span>
                <a class="nav-link" href="#" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Salir
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Navegación de Módulos -->
        <div class="module-nav">
            <ul class="nav nav-pills" id="module-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="dashboard-tab" data-bs-toggle="pill" 
                            data-bs-target="#dashboard" type="button" role="tab">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="lifecycle-tab" data-bs-toggle="pill" 
                            data-bs-target="#lifecycle" type="button" role="tab">
                        <i class="fas fa-project-diagram"></i>
                        Ciclo de Vida
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="qualification-tab" data-bs-toggle="pill" 
                            data-bs-target="#qualification" type="button" role="tab">
                        <i class="fas fa-certificate"></i>
                        Calificación
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="validation-tab" data-bs-toggle="pill" 
                            data-bs-target="#validation" type="button" role="tab">
                        <i class="fas fa-check-double"></i>
                        Validación
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="changes-tab" data-bs-toggle="pill" 
                            data-bs-target="#changes" type="button" role="tab">
                        <i class="fas fa-exchange-alt"></i>
                        Gestión de Cambios
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="monitoring-tab" data-bs-toggle="pill" 
                            data-bs-target="#monitoring" type="button" role="tab">
                        <i class="fas fa-chart-line"></i>
                        Monitoreo
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="risks-tab" data-bs-toggle="pill" 
                            data-bs-target="#risks" type="button" role="tab">
                        <i class="fas fa-exclamation-triangle"></i>
                        Gestión de Riesgos
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="documents-tab" data-bs-toggle="pill" 
                            data-bs-target="#documents" type="button" role="tab">
                        <i class="fas fa-file-alt"></i>
                        Gestión Documental
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="suppliers-tab" data-bs-toggle="pill" 
                            data-bs-target="#suppliers" type="button" role="tab">
                        <i class="fas fa-building"></i>
                        Evaluación de Proveedores
                    </button>
                </li>
            </ul>
        </div>

        <!-- Contenido de los Módulos -->
        <div class="tab-content" id="module-content">
            
            <!-- Dashboard Principal -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <div class="row">
                    <!-- Sistema de Salud General -->
                    <div class="col-12">
                        <div class="system-health fade-in">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h2><i class="fas fa-heartbeat"></i> Estado General del Sistema</h2>
                                    <p class="mb-0">Todos los sistemas operando normalmente. Última verificación: <span id="last-check-time">--</span></p>
                                </div>
                                <div class="col-md-4 text-end">
                                    <div class="gxp-compliance-indicator">
                                        <div class="compliance-score" id="overall-compliance">98.5</div>
                                        <div>Cumplimiento GxP</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Métricas Principales -->
                    <div class="col-lg-3 col-md-6">
                        <div class="card metric-card fade-in">
                            <div class="metric-value" id="active-systems">--</div>
                            <div class="metric-label">Sistemas Activos</div>
                            <div class="mt-2">
                                <small class="text-success">
                                    <i class="fas fa-arrow-up"></i> 
                                    +2 este mes
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6">
                        <div class="card metric-card fade-in">
                            <div class="metric-value text-success" id="validation-success-rate">--</div>
                            <div class="metric-label">Tasa de Éxito Validación</div>
                            <div class="kpi-progress mt-2">
                                <div class="kpi-progress-bar" id="validation-progress" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6">
                        <div class="card metric-card fade-in">
                            <div class="metric-value text-info" id="active-qualifications">--</div>
                            <div class="metric-label">Calificaciones Activas</div>
                            <div class="mt-2">
                                <small class="text-info">
                                    <i class="fas fa-clock"></i> 
                                    3 IQ, 2 OQ, 1 PQ
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6">
                        <div class="card metric-card fade-in">
                            <div class="metric-value text-warning" id="pending-changes">--</div>
                            <div class="metric-label">Cambios Pendientes</div>
                            <div class="mt-2">
                                <small class="text-warning">
                                    <i class="fas fa-exclamation-triangle"></i> 
                                    2 críticos
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Métricas de Gestión Documental -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-file-alt"></i> Gestión Documental GxP</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-3 col-md-6 mb-3">
                                        <div class="text-center">
                                            <div class="metric-value text-primary" id="total-documents">--</div>
                                            <div class="metric-label">Total Documentos</div>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6 mb-3">
                                        <div class="text-center">
                                            <div class="metric-value text-success" id="effective-documents">--</div>
                                            <div class="metric-label">Documentos Vigentes</div>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6 mb-3">
                                        <div class="text-center">
                                            <div class="metric-value text-warning" id="pending-approval-docs">--</div>
                                            <div class="metric-label">Pendientes Aprobación</div>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6 mb-3">
                                        <div class="text-center">
                                            <div class="metric-value text-info" id="electronic-signatures">--</div>
                                            <div class="metric-label">Firmas Electrónicas</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <!-- Actividad Reciente -->
                    <div class="col-lg-6">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-history"></i> Actividad Reciente</h5>
                            </div>
                            <div class="card-body">
                                <div id="recent-activity">
                                    <div class="loading-spinner">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        Cargando actividad...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Alertas Activas -->
                    <div class="col-lg-6">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-exclamation-circle"></i> Alertas Activas</h5>
                                <span class="badge bg-warning" id="alert-count">--</span>
                            </div>
                            <div class="card-body">
                                <div id="active-alerts">
                                    <div class="loading-spinner">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        Cargando alertas...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <!-- Gráfico de Tendencias -->
                    <div class="col-lg-8">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-area"></i> Tendencias de Rendimiento</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="performance-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- KPIs de Cumplimiento -->
                    <div class="col-lg-4">
                        <div class="card fade-in">
                            <div class="card-header">
                                <h5><i class="fas fa-clipboard-check"></i> KPIs de Cumplimiento</h5>
                            </div>
                            <div class="card-body">
                                <div id="compliance-kpis">
                                    <div class="loading-spinner">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        Cargando KPIs...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Módulo de Ciclo de Vida -->
            <div class="tab-pane fade" id="lifecycle" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-project-diagram"></i> Gestión del Ciclo de Vida del Sistema</h5>
                        <button class="btn btn-gamp btn-sm float-end" onclick="createNewLifecycle()">
                            <i class="fas fa-plus"></i> Nuevo Sistema
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="lifecycle-content">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                Cargando sistemas...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Módulo de Calificación -->
            <div class="tab-pane fade" id="qualification" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-certificate"></i> Calificación de Procesos (IQ/OQ/PQ)</h5>
                        <button class="btn btn-gamp btn-sm float-end" onclick="createNewQualification()">
                            <i class="fas fa-plus"></i> Nueva Calificación
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="qualification-content">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                Cargando calificaciones...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Módulo de Validación -->
            <div class="tab-pane fade" id="validation" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-check-double"></i> Validación de Sistemas</h5>
                        <button class="btn btn-gamp btn-sm float-end" onclick="createNewValidation()">
                            <i class="fas fa-plus"></i> Nueva Validación
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="validation-content">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                Cargando validaciones...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Módulo de Gestión de Cambios -->
            <div class="tab-pane fade" id="changes" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-exchange-alt"></i> Gestión de Cambios</h5>
                        <button class="btn btn-gamp btn-sm float-end" onclick="createNewChange()">
                            <i class="fas fa-plus"></i> Nuevo Cambio
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="changes-content">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                Cargando cambios...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Módulo de Monitoreo -->
            <div class="tab-pane fade" id="monitoring" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-line"></i> Monitoreo Continuo</h5>
                        <button class="btn btn-gamp btn-sm float-end" onclick="refreshMonitoring()">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="monitoring-content">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                                Cargando monitoreo...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Módulo de Gestión de Riesgos -->
            <div class="tab-pane fade" id="risks" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-exclamation-triangle"></i> Gestión de Riesgos GAMP 5</h5>
                        <div class="btn-group float-end" role="group">
                            <button class="btn btn-gamp btn-sm" onclick="createNewRiskAssessment()">
                                <i class="fas fa-plus"></i> Nueva Evaluación
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="generateRiskReport()">
                                <i class="fas fa-file-alt"></i> Reporte
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Risk Management Dashboard -->
                        <div class="row mb-4">
                            <div class="col-lg-3 col-md-6">
                                <div class="card metric-card bg-gradient-primary text-white">
                                    <div class="metric-value" id="total-assessments">--</div>
                                    <div class="metric-label">Evaluaciones Activas</div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="card metric-card bg-gradient-danger text-white">
                                    <div class="metric-value" id="critical-risks">--</div>
                                    <div class="metric-label">Riesgos Críticos</div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="card metric-card bg-gradient-warning text-white">
                                    <div class="metric-value" id="high-risks">--</div>
                                    <div class="metric-label">Riesgos Altos</div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="card metric-card bg-gradient-info text-white">
                                    <div class="metric-value" id="pending-mitigations">--</div>
                                    <div class="metric-label">Mitigaciones Pendientes</div>
                                </div>
                            </div>
                        </div>

                        <!-- Risk Matrix and Content -->
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-table"></i> Matriz de Riesgos</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="risk-matrix-container">
                                            <canvas id="risk-matrix-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-exclamation-circle"></i> Riesgos Críticos</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="critical-risks-list">
                                            <div class="loading-spinner">
                                                <i class="fas fa-spinner fa-spin"></i>
                                                Cargando riesgos críticos...
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Risk Assessments Table -->
                        <div class="card mt-4">
                            <div class="card-header">
                                <h6><i class="fas fa-list"></i> Evaluaciones de Riesgo</h6>
                                <div class="float-end">
                                    <select class="form-select form-select-sm" id="risk-filter">
                                        <option value="">Todos los riesgos</option>
                                        <option value="CRITICAL">Críticos</option>
                                        <option value="HIGH">Altos</option>
                                        <option value="MEDIUM">Medios</option>
                                        <option value="LOW">Bajos</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="risks-content">
                                    <div class="loading-spinner">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        Cargando evaluaciones de riesgo...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Módulo de Gestión Documental -->
            <div class="tab-pane fade" id="documents" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-file-alt"></i> Gestión Documental GxP</h5>
                        <div class="btn-group float-end" role="group">
                            <button class="btn btn-gamp btn-sm" onclick="createNewDocument()">
                                <i class="fas fa-plus"></i> Nuevo Documento
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="uploadDocument()">
                                <i class="fas fa-upload"></i> Subir Archivo
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="generateDocumentReport()">
                                <i class="fas fa-chart-bar"></i> Reporte
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Document Management Dashboard -->
                        <div class="row mb-4">
                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card metric-card bg-gradient-primary text-white">
                                    <div class="metric-value" id="doc-total">--</div>
                                    <div class="metric-label">Total</div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card metric-card bg-gradient-success text-white">
                                    <div class="metric-value" id="doc-effective">--</div>
                                    <div class="metric-label">Vigentes</div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card metric-card bg-gradient-warning text-white">
                                    <div class="metric-value" id="doc-pending">--</div>
                                    <div class="metric-label">Pendientes</div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card metric-card bg-gradient-danger text-white">
                                    <div class="metric-value" id="doc-review">--</div>
                                    <div class="metric-label">Por Revisar</div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card metric-card bg-gradient-info text-white">
                                    <div class="metric-value" id="doc-gxp">--</div>
                                    <div class="metric-label">GxP</div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card metric-card bg-gradient-secondary text-white">
                                    <div class="metric-value" id="doc-signatures">--</div>
                                    <div class="metric-label">Firmas</div>
                                </div>
                            </div>
                        </div>

                        <!-- Document Filters and Search -->
                        <div class="row mb-3">
                            <div class="col-lg-3">
                                <select class="form-select" id="doc-type-filter">
                                    <option value="">Todos los tipos</option>
                                </select>
                            </div>
                            <div class="col-lg-3">
                                <select class="form-select" id="doc-status-filter">
                                    <option value="">Todos los estados</option>
                                </select>
                            </div>
                            <div class="col-lg-3">
                                <select class="form-select" id="doc-classification-filter">
                                    <option value="">Todas las clasificaciones</option>
                                </select>
                            </div>
                            <div class="col-lg-3">
                                <input type="text" class="form-control" id="doc-search" placeholder="Buscar documentos...">
                            </div>
                        </div>

                        <!-- Documents Table -->
                        <div class="card">
                            <div class="card-header">
                                <h6><i class="fas fa-list"></i> Documentos</h6>
                                <div class="float-end">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="refreshDocuments()">
                                        <i class="fas fa-sync"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover" id="documents-table">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Número</th>
                                                <th>Título</th>
                                                <th>Tipo</th>
                                                <th>Estado</th>
                                                <th>Versión</th>
                                                <th>Autor</th>
                                                <th>Fecha</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="documents-tbody">
                                            <tr>
                                                <td colspan="8" class="text-center">
                                                    <div class="loading-spinner">
                                                        <i class="fas fa-spinner fa-spin"></i>
                                                        Cargando documentos...
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Document Analytics -->
                        <div class="row mt-4">
                            <div class="col-lg-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-chart-pie"></i> Documentos por Tipo</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="doc-type-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6><i class="fas fa-chart-bar"></i> Documentos por Estado</h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="doc-status-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Evaluación de Proveedores -->
    <div class="tab-pane fade" id="suppliers" role="tabpanel">
        <div class="content-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="fas fa-building"></i> Evaluación de Proveedores GAMP 5</h1>
                    <p class="text-muted">Gestión de calificación y evaluación de proveedores según GAMP 5</p>
                </div>
                <div>
                    <button class="btn btn-gamp me-2" onclick="openRegisterSupplierModal()">
                        <i class="fas fa-plus"></i> Registrar Proveedor
                    </button>
                    <button class="btn btn-outline-primary" onclick="loadSupplierMetrics()">
                        <i class="fas fa-chart-bar"></i> Métricas
                    </button>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <!-- Métricas Rápidas -->
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="metric-card">
                    <div class="metric-icon bg-primary">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="metric-content">
                        <h3 id="total-suppliers">-</h3>
                        <p>Total Proveedores</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="metric-card">
                    <div class="metric-icon bg-success">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="metric-content">
                        <h3 id="approved-suppliers">-</h3>
                        <p>Proveedores Aprobados</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="metric-card">
                    <div class="metric-icon bg-warning">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="metric-content">
                        <h3 id="pending-qualifications">-</h3>
                        <p>Calificaciones Pendientes</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="metric-card">
                    <div class="metric-icon bg-danger">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="metric-content">
                        <h3 id="critical-suppliers">-</h3>
                        <p>Riesgo Crítico</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-list"></i> Lista de Proveedores</h5>
                            <div class="d-flex gap-2">
                                <select class="form-select form-select-sm" id="supplier-type-filter" onchange="filterSuppliers()">
                                    <option value="">Todos los tipos</option>
                                </select>
                                <select class="form-select form-select-sm" id="gamp-category-filter" onchange="filterSuppliers()">
                                    <option value="">Todas las categorías GAMP</option>
                                </select>
                                <select class="form-select form-select-sm" id="risk-level-filter" onchange="filterSuppliers()">
                                    <option value="">Todos los niveles de riesgo</option>
                                </select>
                                <input type="text" class="form-control form-control-sm" id="supplier-search" 
                                       placeholder="Buscar proveedor..." onkeyup="searchSuppliers()">
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Nombre</th>
                                        <th>Tipo</th>
                                        <th>Categoría GAMP</th>
                                        <th>Nivel de Riesgo</th>
                                        <th>Estado</th>
                                        <th>Última Calificación</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="suppliers-table-body">
                                    <tr>
                                        <td colspan="8" class="text-center">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Supplier Details Tabs -->
        <div class="row mt-4" id="supplier-details" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="supplier-tabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="info-tab" data-bs-toggle="tab" 
                                        data-bs-target="#supplier-info" type="button" role="tab">
                                    <i class="fas fa-info-circle"></i> Información General
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="qualifications-tab" data-bs-toggle="tab" 
                                        data-bs-target="#supplier-qualifications" type="button" role="tab">
                                    <i class="fas fa-certificate"></i> Calificaciones
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="audits-tab" data-bs-toggle="tab" 
                                        data-bs-target="#supplier-audits" type="button" role="tab">
                                    <i class="fas fa-search"></i> Auditorías
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="supplier-tab-content">
                            <div class="tab-pane fade show active" id="supplier-info" role="tabpanel">
                                <div id="supplier-info-content">
                                    <!-- Información del proveedor cargada dinámicamente -->
                                </div>
                            </div>
                            <div class="tab-pane fade" id="supplier-qualifications" role="tabpanel">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6><i class="fas fa-certificate"></i> Historial de Calificaciones</h6>
                                    <button class="btn btn-gamp btn-sm" onclick="startNewQualification()">
                                        <i class="fas fa-plus"></i> Nueva Calificación
                                    </button>
                                </div>
                                <div id="qualifications-content">
                                    <!-- Lista de calificaciones -->
                                </div>
                            </div>
                            <div class="tab-pane fade" id="supplier-audits" role="tabpanel">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6><i class="fas fa-search"></i> Historial de Auditorías</h6>
                                    <button class="btn btn-gamp btn-sm" onclick="scheduleNewAudit()">
                                        <i class="fas fa-calendar-plus"></i> Programar Auditoría
                                    </button>
                                </div>
                                <div id="audits-content">
                                    <!-- Lista de auditorías -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Supplier Analytics -->
        <div class="row mt-4">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h6><i class="fas fa-chart-pie"></i> Proveedores por Tipo</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="supplier-type-chart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h6><i class="fas fa-chart-bar"></i> Distribución por Categoría GAMP</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="gamp-category-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Modals -->
    
    <!-- Create Document Modal -->
    <div class="modal fade" id="createDocumentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-file-plus"></i> Crear Nuevo Documento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createDocumentForm">
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Título *</label>
                                <input type="text" class="form-control" id="doc-title" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tipo de Documento *</label>
                                <select class="form-select" id="doc-type" required>
                                    <option value="">Seleccionar tipo</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Clasificación *</label>
                                <select class="form-select" id="doc-classification" required>
                                    <option value="">Seleccionar clasificación</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Departamento</label>
                                <input type="text" class="form-control" id="doc-department">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Descripción</label>
                                <textarea class="form-control" id="doc-description" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Período de Retención (años)</label>
                                <input type="number" class="form-control" id="doc-retention" value="7" min="1" max="25">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fecha de Revisión</label>
                                <input type="date" class="form-control" id="doc-review-date">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Contenido Inicial</label>
                                <textarea class="form-control" id="doc-content" rows="4" placeholder="Contenido inicial del documento..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-gamp" onclick="saveNewDocument()">
                        <i class="fas fa-save"></i> Crear Documento
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign Document Modal -->
    <div class="modal fade" id="signDocumentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-signature"></i> Firma Electrónica</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        La firma electrónica se rige por 21 CFR Part 11. Su identidad será verificada antes de proceder.
                    </div>
                    <form id="signDocumentForm">
                        <input type="hidden" id="sign-document-id">
                        <div class="mb-3">
                            <label class="form-label">Tipo de Firma *</label>
                            <select class="form-select" id="signature-type" required>
                                <option value="">Seleccionar tipo</option>
                                <option value="AUTHOR">Autor</option>
                                <option value="REVIEWER">Revisor</option>
                                <option value="APPROVER">Aprobador</option>
                                <option value="QA_APPROVAL">Aprobación QA</option>
                                <option value="TECHNICAL_APPROVAL">Aprobación Técnica</option>
                                <option value="MANAGEMENT_APPROVAL">Aprobación Gerencial</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Significado de la Firma *</label>
                            <textarea class="form-control" id="signature-meaning" rows="2" 
                                      placeholder="Ej: Apruebo este documento como válido y conforme..." required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Confirmar Contraseña *</label>
                            <input type="password" class="form-control" id="signature-password" 
                                   placeholder="Ingrese su contraseña para confirmar identidad" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="executeSignature()">
                        <i class="fas fa-pen-nib"></i> Firmar Documento
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier Modals -->
    
    <!-- Register Supplier Modal -->
    <div class="modal fade" id="registerSupplierModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-building-user"></i> Registrar Nuevo Proveedor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="registerSupplierForm">
                        <div class="row">
                            <div class="col-md-8">
                                <label class="form-label">Nombre del Proveedor *</label>
                                <input type="text" class="form-control" id="supplier-name" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Tipo de Proveedor *</label>
                                <select class="form-select" id="supplier-type" required>
                                    <option value="">Seleccionar tipo</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Categoría GAMP *</label>
                                <select class="form-select" id="supplier-gamp-category" required>
                                    <option value="">Seleccionar categoría</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Nivel de Riesgo *</label>
                                <select class="form-select" id="supplier-risk-level" required>
                                    <option value="">Seleccionar nivel</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Persona de Contacto</label>
                                <input type="text" class="form-control" id="supplier-contact-person">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email de Contacto *</label>
                                <input type="email" class="form-control" id="supplier-contact-email" required>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Teléfono</label>
                                <input type="text" class="form-control" id="supplier-contact-phone">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">País</label>
                                <input type="text" class="form-control" id="supplier-country">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Sitio Web</label>
                                <input type="url" class="form-control" id="supplier-website">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Número de Registro</label>
                                <input type="text" class="form-control" id="supplier-registration">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Dirección</label>
                                <textarea class="form-control" id="supplier-address" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Descripción de Servicios/Productos</label>
                                <textarea class="form-control" id="supplier-description" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-gamp" onclick="saveNewSupplier()">
                        <i class="fas fa-save"></i> Registrar Proveedor
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Start Qualification Modal -->
    <div class="modal fade" id="startQualificationModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-certificate"></i> Iniciar Proceso de Calificación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="startQualificationForm">
                        <input type="hidden" id="qualification-supplier-id">
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Tipo de Calificación *</label>
                                <select class="form-select" id="qualification-type" required>
                                    <option value="">Seleccionar tipo</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fecha Objetivo de Finalización</label>
                                <input type="date" class="form-control" id="qualification-target-date">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Justificación del Negocio *</label>
                                <textarea class="form-control" id="qualification-justification" rows="3" required></textarea>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Descripción del Alcance</label>
                                <textarea class="form-control" id="qualification-scope" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Aspectos Críticos</label>
                                <textarea class="form-control" id="qualification-critical-aspects" rows="2" 
                                          placeholder="Ej: Cumplimiento GxP, seguridad de datos, continuidad del servicio..."></textarea>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Requerimientos Regulatorios</label>
                                <textarea class="form-control" id="qualification-regulatory" rows="2" 
                                          placeholder="Ej: 21 CFR Part 11, EU GMP Annex 11, ISO 27001..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-gamp" onclick="saveNewQualification()">
                        <i class="fas fa-play"></i> Iniciar Calificación
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Evaluation Criteria Modal -->
    <div class="modal fade" id="evaluationCriteriaModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-list-check"></i> Evaluación de Criterios</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        Evalúe cada criterio con una puntuación de 0-100. La puntuación total se calculará automáticamente.
                    </div>
                    <form id="evaluationCriteriaForm">
                        <input type="hidden" id="evaluation-qualification-id">
                        <div id="criteria-evaluation-content">
                            <!-- Dynamic criteria content -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="saveEvaluation()">
                        <i class="fas fa-save"></i> Guardar Evaluación
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Audit Modal -->
    <div class="modal fade" id="scheduleAuditModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-calendar-plus"></i> Programar Auditoría</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="scheduleAuditForm">
                        <input type="hidden" id="audit-supplier-id">
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Tipo de Auditoría *</label>
                                <select class="form-select" id="audit-type" required>
                                    <option value="">Seleccionar tipo</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fecha Planificada *</label>
                                <input type="date" class="form-control" id="audit-planned-date" required>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Alcance de la Auditoría *</label>
                                <textarea class="form-control" id="audit-scope" rows="3" required></textarea>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Objetivos</label>
                                <textarea class="form-control" id="audit-objectives" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Criterios de Éxito</label>
                                <textarea class="form-control" id="audit-success-criteria" rows="2"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-gamp" onclick="saveNewAudit()">
                        <i class="fas fa-calendar-check"></i> Programar Auditoría
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    
    <script>
        // Variables globales
        let currentModule = 'dashboard';
        let refreshInterval;
        let performanceChart;

        // Inicialización
        document.addEventListener('DOMContentLoaded', function () {
            initializeGAMP5Dashboard();
            loadDashboardData();
            
            // Configurar actualización automática cada 30 segundos
            refreshInterval = setInterval(refreshDashboard, 30000);
            
            // Event listeners para las pestañas
            document.querySelectorAll('[data-bs-toggle="pill"]').forEach(tab => {
                tab.addEventListener('shown.bs.tab', function (e) {
                    currentModule = e.target.getAttribute('data-bs-target').substring(1);
                    loadModuleContent(currentModule);
                });
            });
        });

        /**
         * Inicialización del dashboard GAMP 5
         */
        function initializeGAMP5Dashboard() {
            // Verificar autenticación
            if (!isAuthenticated()) {
                window.location.href = '/login';
                return;
            }

            // Configurar usuario actual
            loadCurrentUser();
            
            // Inicializar gráficos
            initializeCharts();
            
            console.log('GAMP 5 Dashboard inicializado correctamente');
        }

        /**
         * Carga los datos principales del dashboard
         */
        async function loadDashboardData() {
            try {
                showLoading('dashboard');
                
                const response = await fetch('/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=dashboard&action=dashboard');
                const result = await response.json();
                
                if (result.success) {
                    updateDashboardMetrics(result.data.overview);
                    updateRecentActivity(result.data.recent_activity);
                    updateActiveAlerts(result.data.alerts);
                    updateKPIs(result.data.kpis);
                    updateComplianceStatus(result.data.compliance_status);
                    updatePerformanceChart();
                    
                    document.getElementById('last-check-time').textContent = 
                        moment(result.data.timestamp).format('DD/MM/YYYY HH:mm:ss');
                } else {
                    showError('Error al cargar datos del dashboard');
                }
                
                hideLoading('dashboard');
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showError('Error de conexión al cargar el dashboard');
                hideLoading('dashboard');
            }
        }

        /**
         * Actualiza las métricas principales del dashboard
         */
        function updateDashboardMetrics(overview) {
            document.getElementById('active-systems').textContent = overview.system_lifecycle.active_systems;
            document.getElementById('validation-success-rate').textContent = overview.validations.compliance_rate + '%';
            document.getElementById('active-qualifications').textContent = overview.qualifications.active_qualifications;
            document.getElementById('pending-changes').textContent = overview.change_management.open_changes;
            
            // Actualizar métricas de gestión documental
            if (overview.document_management) {
                document.getElementById('total-documents').textContent = overview.document_management.total_documents;
                document.getElementById('effective-documents').textContent = overview.document_management.effective_documents;
                document.getElementById('pending-approval-docs').textContent = overview.document_management.pending_approval;
                document.getElementById('electronic-signatures').textContent = overview.document_management.electronic_signatures;
            }
            
            // Actualizar métricas de evaluación de proveedores
            if (overview.supplier_assessment) {
                const totalSuppliersEl = document.getElementById('total-suppliers');
                const approvedSuppliersEl = document.getElementById('approved-suppliers');  
                const pendingQualificationsEl = document.getElementById('pending-qualifications');
                const criticalSuppliersEl = document.getElementById('critical-suppliers');
                
                if (totalSuppliersEl) totalSuppliersEl.textContent = overview.supplier_assessment.total_suppliers;
                if (approvedSuppliersEl) approvedSuppliersEl.textContent = overview.supplier_assessment.approved_suppliers;
                if (pendingQualificationsEl) pendingQualificationsEl.textContent = overview.supplier_assessment.pending_qualification;
                if (criticalSuppliersEl) criticalSuppliersEl.textContent = overview.supplier_assessment.critical_risk_suppliers;
            }
            
            // Actualizar barra de progreso de validación
            const validationProgress = document.getElementById('validation-progress');
            validationProgress.style.width = overview.validations.compliance_rate + '%';
        }

        /**
         * Actualiza la actividad reciente
         */
        function updateRecentActivity(activities) {
            const container = document.getElementById('recent-activity');
            container.innerHTML = '';
            
            activities.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <strong>${activity.activity}</strong><br>
                            <small class="text-muted">por ${activity.user}</small>
                        </div>
                        <div class="activity-time">
                            ${moment(activity.timestamp).fromNow()}
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        /**
         * Actualiza las alertas activas
         */
        function updateActiveAlerts(alerts) {
            const container = document.getElementById('active-alerts');
            const alertCount = document.getElementById('alert-count');
            
            container.innerHTML = '';
            alertCount.textContent = alerts.length;
            
            if (alerts.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No hay alertas activas</div>';
                return;
            }
            
            alerts.forEach(alert => {
                const item = document.createElement('div');
                item.className = `alert-item ${alert.severity === 'CRITICAL' ? 'alert-critical' : ''}`;
                item.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <strong>${alert.title}</strong><br>
                            <small class="text-muted">${alert.type} - ${moment(alert.created_at).fromNow()}</small>
                        </div>
                        <span class="badge bg-${getSeverityColor(alert.severity)}">${alert.severity}</span>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        /**
         * Actualiza los KPIs de cumplimiento
         */
        function updateKPIs(kpis) {
            const container = document.getElementById('compliance-kpis');
            container.innerHTML = '';
            
            const kpiItems = [
                { label: 'Cumplimiento GxP', value: kpis.gxp_compliance_rate, unit: '%' },
                { label: 'Disponibilidad Sistema', value: kpis.system_availability, unit: '%' },
                { label: 'Éxito de Cambios', value: kpis.change_success_rate, unit: '%' },
                { label: 'Integridad de Datos', value: kpis.data_integrity_score, unit: '%' },
                { label: 'MTTR', value: kpis.mttr, unit: ' min' }
            ];
            
            kpiItems.forEach(kpi => {
                const item = document.createElement('div');
                item.className = 'mb-3';
                item.innerHTML = `
                    <div class="d-flex justify-content-between">
                        <span>${kpi.label}</span>
                        <strong>${kpi.value}${kpi.unit}</strong>
                    </div>
                    <div class="kpi-progress">
                        <div class="kpi-progress-bar" style="width: ${Math.min(kpi.value, 100)}%"></div>
                    </div>
                `;
                container.appendChild(item);
            });
            
            // Actualizar cumplimiento general
            document.getElementById('overall-compliance').textContent = kpis.gxp_compliance_rate + '%';
        }

        /**
         * Inicializa los gráficos
         */
        function initializeCharts() {
            const ctx = document.getElementById('performance-chart').getContext('2d');
            
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Disponibilidad del Sistema (%)',
                        data: [],
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        tension: 0.1
                    }, {
                        label: 'Cumplimiento GxP (%)',
                        data: [],
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        /**
         * Actualiza el gráfico de rendimiento
         */
        function updatePerformanceChart() {
            // Datos simulados - en producción vendrían del backend
            const labels = [];
            const availabilityData = [];
            const complianceData = [];
            
            for (let i = 6; i >= 0; i--) {
                labels.push(moment().subtract(i, 'days').format('DD/MM'));
                availabilityData.push(99.5 + Math.random() * 0.5);
                complianceData.push(98 + Math.random() * 2);
            }
            
            performanceChart.data.labels = labels;
            performanceChart.data.datasets[0].data = availabilityData;
            performanceChart.data.datasets[1].data = complianceData;
            performanceChart.update();
        }

        /**
         * Carga el contenido de un módulo específico
         */
        async function loadModuleContent(module) {
            if (module === 'dashboard') {
                loadDashboardData();
                return;
            }
            
            const contentContainer = document.getElementById(`${module}-content`);
            showLoading(module);
            
            try {
                let endpoint = '';
                switch (module) {
                    case 'lifecycle':
                        endpoint = `/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=lifecycle&action=list`;
                        break;
                    case 'qualification':
                        endpoint = `/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=qualification&action=list`;
                        break;
                    case 'validation':
                        endpoint = `/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=validation&action=list`;
                        break;
                    case 'changes':
                        endpoint = `/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=changes&action=list`;
                        break;
                    case 'monitoring':
                        endpoint = `/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=monitoring&action=system_status`;
                        break;
                    case 'risks':
                        endpoint = `/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=risks&action=dashboard`;
                        break;
                    case 'documents':
                        endpoint = `/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=documents&action=metrics`;
                        break;
                    case 'suppliers':
                        loadSuppliersData();
                        hideLoading(module);
                        return;
                }
                
                const response = await fetch(endpoint);
                const result = await response.json();
                
                if (result.success) {
                    renderModuleContent(module, result.data);
                } else {
                    showError(`Error al cargar ${module}: ${result.error}`);
                }
                
                hideLoading(module);
            } catch (error) {
                console.error(`Error loading ${module}:`, error);
                showError(`Error de conexión al cargar ${module}`);
                hideLoading(module);
            }
        }

        /**
         * Renderiza el contenido de un módulo
         */
        function renderModuleContent(module, data) {
            const container = document.getElementById(`${module}-content`);
            
            switch (module) {
                case 'lifecycle':
                    renderLifecycleContent(container, data);
                    break;
                case 'qualification':
                    renderQualificationContent(container, data);
                    break;
                case 'validation':
                    renderValidationContent(container, data);
                    break;
                case 'changes':
                    renderChangesContent(container, data);
                    break;
                case 'monitoring':
                    renderMonitoringContent(container, data);
                    break;
                case 'risks':
                    renderRisksContent(container, data);
                    break;
                case 'documents':
                    renderDocumentsContent(container, data);
                    break;
            }
        }

        /**
         * Renderiza el contenido del módulo de ciclo de vida
         */
        function renderLifecycleContent(container, systems) {
            if (!systems || systems.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No hay sistemas registrados</div>';
                return;
            }
            
            let html = `
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Sistema</th>
                                <th>Etapa Actual</th>
                                <th>Estado</th>
                                <th>Progreso</th>
                                <th>Próxima Verificación</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            systems.forEach(system => {
                html += `
                    <tr>
                        <td>
                            <strong>${system.system_name}</strong><br>
                            <small class="text-muted">${system.description}</small>
                        </td>
                        <td>
                            <span class="badge bg-info">${system.current_stage}</span>
                        </td>
                        <td>
                            <span class="status-indicator status-${system.status.toLowerCase()}"></span>
                            ${system.status}
                        </td>
                        <td>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar" style="width: ${system.completion_percentage}%"></div>
                            </div>
                            <small>${system.completion_percentage}%</small>
                        </td>
                        <td>${moment(system.next_verification).format('DD/MM/YYYY')}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewLifecycleDetails('${system.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success" onclick="updateLifecycleStage('${system.id}')">
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Funciones auxiliares
        function showLoading(module) {
            const container = document.getElementById(`${module}-content`) || 
                           document.querySelector(`#${module} .loading-spinner`);
            if (container) {
                const spinner = container.querySelector('.loading-spinner');
                if (spinner) spinner.style.display = 'block';
            }
        }

        function hideLoading(module) {
            const container = document.getElementById(`${module}-content`) || 
                           document.querySelector(`#${module} .loading-spinner`);
            if (container) {
                const spinner = container.querySelector('.loading-spinner');
                if (spinner) spinner.style.display = 'none';
            }
        }

        function showError(message) {
            // Implementar sistema de notificaciones
            console.error(message);
            alert(message); // Temporal - reemplazar con toast/modal
        }

        function getSeverityColor(severity) {
            switch (severity) {
                case 'CRITICAL': return 'danger';
                case 'WARNING': return 'warning';
                case 'MINOR': return 'info';
                default: return 'secondary';
            }
        }

        function isAuthenticated() {
            // Verificar autenticación - implementar según sistema de autenticación
            return true; // Temporal
        }

        function loadCurrentUser() {
            // Cargar información del usuario actual
            document.getElementById('current-user').textContent = 'Administrador GAMP 5';
        }

        function refreshDashboard() {
            if (currentModule === 'dashboard') {
                loadDashboardData();
            }
        }

        function logout() {
            if (confirm('¿Está seguro que desea cerrar sesión?')) {
                window.location.href = '/logout';
            }
        }

        // Funciones placeholder para las acciones de los módulos
        function createNewLifecycle() { console.log('Create new lifecycle'); }
        function createNewQualification() { console.log('Create new qualification'); }
        function createNewValidation() { console.log('Create new validation'); }
        function createNewChange() { console.log('Create new change'); }
        function refreshMonitoring() { console.log('Refresh monitoring'); }
        function viewLifecycleDetails(id) { console.log('View lifecycle details:', id); }
        function updateLifecycleStage(id) { console.log('Update lifecycle stage:', id); }
        
        // Funciones del módulo de riesgos
        function createNewRiskAssessment() {
            // Implementar modal para crear nueva evaluación de riesgo
            console.log('Create new risk assessment');
        }
        
        function generateRiskReport() {
            // Implementar generación de reportes de riesgo
            console.log('Generate risk report');
        }
        
        function viewRiskDetails(id) {
            console.log('View risk details:', id);
        }
        
        function createMitigation(riskId) {
            console.log('Create mitigation for risk:', riskId);
        }

        // Funciones del módulo de gestión documental
        async function initializeDocumentModule() {
            try {
                // Cargar tipos de documentos
                await loadDocumentTypes();
                // Cargar estados
                await loadDocumentStatuses();
                // Cargar clasificaciones
                await loadDocumentClassifications();
                // Cargar documentos
                await loadDocuments();
            } catch (error) {
                console.error('Error initializing document module:', error);
            }
        }

        async function loadDocumentTypes() {
            try {
                const response = await fetch('/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=documents&action=types');
                const result = await response.json();
                
                if (result.success) {
                    const typeSelects = ['doc-type', 'doc-type-filter'];
                    typeSelects.forEach(selectId => {
                        const select = document.getElementById(selectId);
                        if (select) {
                            select.innerHTML = selectId.includes('filter') ? '<option value="">Todos los tipos</option>' : '<option value="">Seleccionar tipo</option>';
                            
                            Object.entries(result.data).forEach(([key, value]) => {
                                const option = document.createElement('option');
                                option.value = key;
                                option.textContent = value;
                                select.appendChild(option);
                            });
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading document types:', error);
            }
        }

        async function loadDocumentStatuses() {
            try {
                const response = await fetch('/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=documents&action=statuses');
                const result = await response.json();
                
                if (result.success) {
                    const statusSelect = document.getElementById('doc-status-filter');
                    if (statusSelect) {
                        statusSelect.innerHTML = '<option value="">Todos los estados</option>';
                        
                        Object.entries(result.data).forEach(([key, value]) => {
                            const option = document.createElement('option');
                            option.value = key;
                            option.textContent = value;
                            statusSelect.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading document statuses:', error);
            }
        }

        async function loadDocumentClassifications() {
            try {
                const response = await fetch('/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=documents&action=classifications');
                const result = await response.json();
                
                if (result.success) {
                    const classSelects = ['doc-classification', 'doc-classification-filter'];
                    classSelects.forEach(selectId => {
                        const select = document.getElementById(selectId);
                        if (select) {
                            select.innerHTML = selectId.includes('filter') ? '<option value="">Todas las clasificaciones</option>' : '<option value="">Seleccionar clasificación</option>';
                            
                            Object.entries(result.data).forEach(([key, value]) => {
                                const option = document.createElement('option');
                                option.value = key;
                                option.textContent = value;
                                select.appendChild(option);
                            });
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading document classifications:', error);
            }
        }

        async function loadDocuments(filters = {}) {
            try {
                const params = new URLSearchParams({
                    ...filters,
                    limit: 50,
                    offset: 0
                });
                
                const response = await fetch(`/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=documents&action=list&${params}`);
                const result = await response.json();
                
                if (result.success) {
                    renderDocumentsTable(result.data);
                } else {
                    showError('Error al cargar documentos: ' + result.error);
                }
            } catch (error) {
                console.error('Error loading documents:', error);
                showError('Error de conexión al cargar documentos');
            }
        }

        function renderDocumentsTable(documents) {
            const tbody = document.getElementById('documents-tbody');
            
            if (!documents || documents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">No hay documentos disponibles</td></tr>';
                return;
            }
            
            let html = '';
            documents.forEach(doc => {
                html += `
                    <tr>
                        <td>
                            <code>${doc.document_number}</code>
                        </td>
                        <td>
                            <strong>${doc.title}</strong>
                            ${doc.description ? `<br><small class="text-muted">${doc.description}</small>` : ''}
                        </td>
                        <td>
                            <span class="badge bg-info">${getDocumentTypeLabel(doc.document_type)}</span>
                        </td>
                        <td>
                            <span class="badge bg-${getDocumentStatusColor(doc.status)}">${doc.status}</span>
                        </td>
                        <td>
                            <span class="badge bg-secondary">${doc.version}</span>
                        </td>
                        <td>
                            ${doc.author_name || 'N/A'}
                        </td>
                        <td>
                            ${moment(doc.created_at).format('DD/MM/YYYY')}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <button class="btn btn-outline-primary" onclick="viewDocument('${doc.id}')" title="Ver">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-success" onclick="signDocument('${doc.id}')" title="Firmar">
                                    <i class="fas fa-signature"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="viewDocumentVersions('${doc.id}')" title="Versiones">
                                    <i class="fas fa-history"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function getDocumentTypeLabel(type) {
            const types = {
                'URS': 'URS',
                'FS': 'Func Spec',
                'DS': 'Design Spec',
                'SOP': 'SOP',
                'VMP': 'VMP',
                'IQ': 'IQ',
                'OQ': 'OQ',
                'PQ': 'PQ',
                'PROTOCOL': 'Protocol',
                'REPORT': 'Report'
            };
            return types[type] || type;
        }

        function getDocumentStatusColor(status) {
            switch (status) {
                case 'EFFECTIVE': return 'success';
                case 'APPROVED': return 'info';
                case 'UNDER_REVIEW': return 'warning';
                case 'DRAFT': return 'secondary';
                case 'RETIRED': return 'dark';
                case 'SUPERSEDED': return 'light';
                default: return 'secondary';
            }
        }

        function createNewDocument() {
            const modal = new bootstrap.Modal(document.getElementById('createDocumentModal'));
            modal.show();
        }

        async function saveNewDocument() {
            try {
                const formData = {
                    title: document.getElementById('doc-title').value,
                    document_type: document.getElementById('doc-type').value,
                    classification: document.getElementById('doc-classification').value,
                    department: document.getElementById('doc-department').value,
                    description: document.getElementById('doc-description').value,
                    retention_period: document.getElementById('doc-retention').value,
                    review_date: document.getElementById('doc-review-date').value,
                    content: document.getElementById('doc-content').value
                };

                // Validar campos requeridos
                if (!formData.title || !formData.document_type || !formData.classification) {
                    showError('Por favor complete todos los campos requeridos');
                    return;
                }

                const response = await fetch('/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=documents&action=create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    showSuccess('Documento creado exitosamente');
                    bootstrap.Modal.getInstance(document.getElementById('createDocumentModal')).hide();
                    document.getElementById('createDocumentForm').reset();
                    await loadDocuments();
                } else {
                    showError('Error al crear documento: ' + result.error);
                }
            } catch (error) {
                console.error('Error creating document:', error);
                showError('Error de conexión al crear documento');
            }
        }

        function signDocument(documentId) {
            document.getElementById('sign-document-id').value = documentId;
            const modal = new bootstrap.Modal(document.getElementById('signDocumentModal'));
            modal.show();
        }

        async function executeSignature() {
            try {
                const documentId = document.getElementById('sign-document-id').value;
                const signatureData = {
                    document_id: documentId,
                    signature_type: document.getElementById('signature-type').value,
                    signature_meaning: document.getElementById('signature-meaning').value,
                    password: document.getElementById('signature-password').value
                };

                // Validar campos requeridos
                if (!signatureData.signature_type || !signatureData.signature_meaning || !signatureData.password) {
                    showError('Por favor complete todos los campos requeridos');
                    return;
                }

                const response = await fetch('/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=documents&action=sign', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(signatureData)
                });

                const result = await response.json();

                if (result.success) {
                    showSuccess('Documento firmado exitosamente');
                    bootstrap.Modal.getInstance(document.getElementById('signDocumentModal')).hide();
                    document.getElementById('signDocumentForm').reset();
                    await loadDocuments();
                } else {
                    showError('Error al firmar documento: ' + result.error);
                }
            } catch (error) {
                console.error('Error signing document:', error);
                showError('Error de conexión al firmar documento');
            }
        }

        function viewDocument(documentId) {
            // Implementar vista de documento
            console.log('View document:', documentId);
        }

        function viewDocumentVersions(documentId) {
            // Implementar vista de versiones
            console.log('View document versions:', documentId);
        }

        function uploadDocument() {
            // Implementar subida de archivos
            console.log('Upload document');
        }

        function generateDocumentReport() {
            // Implementar generación de reportes
            console.log('Generate document report');
        }

        function refreshDocuments() {
            loadDocuments();
        }

        // Event listeners para filtros de documentos
        document.addEventListener('DOMContentLoaded', function() {
            const filters = ['doc-type-filter', 'doc-status-filter', 'doc-classification-filter', 'doc-search'];
            
            filters.forEach(filterId => {
                const element = document.getElementById(filterId);
                if (element) {
                    element.addEventListener('change', applyDocumentFilters);
                    if (filterId === 'doc-search') {
                        element.addEventListener('input', debounce(applyDocumentFilters, 500));
                    }
                }
            });
        });

        function applyDocumentFilters() {
            const filters = {
                document_type: document.getElementById('doc-type-filter')?.value || '',
                status: document.getElementById('doc-status-filter')?.value || '',
                classification: document.getElementById('doc-classification-filter')?.value || '',
                search: document.getElementById('doc-search')?.value || ''
            };

            loadDocuments(Object.fromEntries(Object.entries(filters).filter(([_, v]) => v !== '')));
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Renderizado de contenido para otros módulos (placeholder)
        function renderQualificationContent(container, data) {
            container.innerHTML = '<div class="text-center">Módulo de Calificación - En desarrollo</div>';
        }

        /**
         * Renderiza el contenido del módulo de gestión documental
         */
        function renderDocumentsContent(container, data) {
            // Actualizar métricas específicas del módulo de documentos
            updateDocumentModuleMetrics(data.metrics);
            
            // Inicializar el módulo de documentos
            initializeDocumentModule();
        }

        /**
         * Actualiza las métricas específicas del módulo de documentos
         */
        function updateDocumentModuleMetrics(metrics) {
            if (metrics) {
                document.getElementById('doc-total').textContent = metrics.general.total_documents || 0;
                document.getElementById('doc-effective').textContent = metrics.general.effective_documents || 0;
                document.getElementById('doc-pending').textContent = metrics.general.pending_approval || 0;
                document.getElementById('doc-review').textContent = metrics.general.due_for_review || 0;
                document.getElementById('doc-gxp').textContent = metrics.by_classification.find(c => c.classification === 'GXP_CRITICAL')?.count || 0;
                document.getElementById('doc-signatures').textContent = '0'; // Se calculará dinámicamente
            }
        }
        
        function renderValidationContent(container, data) {
            container.innerHTML = '<div class="text-center">Módulo de Validación - En desarrollo</div>';
        }
        
        function renderChangesContent(container, data) {
            container.innerHTML = '<div class="text-center">Módulo de Gestión de Cambios - En desarrollo</div>';
        }
        
        function renderMonitoringContent(container, data) {
            container.innerHTML = '<div class="text-center">Módulo de Monitoreo - En desarrollo</div>';
        }
        
        /**
         * Renderiza el contenido del módulo de gestión de riesgos
         */
        function renderRisksContent(container, data) {
            // Actualizar métricas principales
            updateRiskMetrics(data.overview);
            
            // Actualizar lista de riesgos críticos
            updateCriticalRisksList(data.high_priority_risks);
            
            // Render risk matrix
            renderRiskMatrix(data.risk_trends);
            
            // Cargar lista de evaluaciones
            loadRiskAssessments();
        }
        
        /**
         * Actualiza las métricas de riesgo en el dashboard
         */
        function updateRiskMetrics(overview) {
            if (overview) {
                document.getElementById('total-assessments').textContent = overview.total_assessments || 0;
                document.getElementById('critical-risks').textContent = overview.critical_risks || 0;
                document.getElementById('high-risks').textContent = overview.high_risks || 0;
                document.getElementById('pending-mitigations').textContent = overview.pending_mitigations || 0;
            }
        }
        
        /**
         * Actualiza la lista de riesgos críticos
         */
        function updateCriticalRisksList(criticalRisks) {
            const container = document.getElementById('critical-risks-list');
            container.innerHTML = '';
            
            if (!criticalRisks || criticalRisks.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No hay riesgos críticos</div>';
                return;
            }
            
            criticalRisks.forEach(risk => {
                const item = document.createElement('div');
                item.className = 'border-bottom pb-2 mb-2';
                item.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <strong class="text-danger">${risk.risk_title}</strong><br>
                            <small class="text-muted">${risk.system_name}</small><br>
                            <span class="badge bg-danger">Score: ${risk.initial_risk_score}</span>
                        </div>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewRiskDetails('${risk.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        /**
         * Renderiza la matriz de riesgos
         */
        function renderRiskMatrix(riskData) {
            // Implementar matriz de riesgos con Chart.js
            const ctx = document.getElementById('risk-matrix-chart');
            if (ctx) {
                // Placeholder para matriz de riesgos
                ctx.getContext('2d').fillText('Matriz de Riesgos - En desarrollo', 10, 50);
            }
        }
        
        /**
         * Carga las evaluaciones de riesgo
         */
        async function loadRiskAssessments() {
            try {
                const response = await fetch('/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=risks&action=list');
                const result = await response.json();
                
                if (result.success) {
                    renderRiskAssessmentsTable(result.data);
                } else {
                    console.error('Error loading risk assessments:', result.error);
                }
            } catch (error) {
                console.error('Error loading risk assessments:', error);
            }
        }
        
        /**
         * Renderiza la tabla de evaluaciones de riesgo
         */
        function renderRiskAssessmentsTable(assessments) {
            const container = document.getElementById('risks-content');
            
            if (!assessments || assessments.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No hay evaluaciones de riesgo</div>';
                return;
            }
            
            let html = `
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Sistema</th>
                                <th>Categoría GAMP</th>
                                <th>Riesgos Críticos</th>
                                <th>Riesgos Altos</th>
                                <th>Estado</th>
                                <th>Última Revisión</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            assessments.forEach(assessment => {
                html += `
                    <tr>
                        <td>
                            <strong>${assessment.system_name}</strong><br>
                            <small class="text-muted">${assessment.assessment_name}</small>
                        </td>
                        <td>
                            <span class="badge bg-info">Cat ${assessment.gamp_category}</span>
                        </td>
                        <td>
                            <span class="badge bg-danger">${assessment.critical_risks || 0}</span>
                        </td>
                        <td>
                            <span class="badge bg-warning">${assessment.high_risks || 0}</span>
                        </td>
                        <td>
                            <span class="badge bg-${getStatusColor(assessment.status)}">${assessment.status}</span>
                        </td>
                        <td>${moment(assessment.updated_at).format('DD/MM/YYYY')}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewRiskDetails('${assessment.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success" onclick="createMitigation('${assessment.id}')">
                                <i class="fas fa-shield-alt"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }
        
        /**
         * Obtiene el color del badge según el estado
         */
        function getStatusColor(status) {
            switch (status) {
                case 'APPROVED': return 'success';
                case 'IN_REVIEW': return 'warning';
                case 'DRAFT': return 'secondary';
                case 'IMPLEMENTED': return 'primary';
                case 'CLOSED': return 'dark';
                default: return 'secondary';
            }
        }

        // ===== SUPPLIER ASSESSMENT FUNCTIONS =====

        /**
         * Carga los datos del módulo de proveedores
         */
        async function loadSuppliersData() {
            try {
                showLoading('suppliers');
                
                // Cargar constantes
                const constantsResponse = await fetch('/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=suppliers&action=constants');
                const constantsResult = await constantsResponse.json();
                
                if (constantsResult.success) {
                    populateSupplierConstants(constantsResult.data);
                }
                
                // Cargar lista de proveedores
                const suppliersResponse = await fetch('/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=suppliers&action=list');
                const suppliersResult = await suppliersResponse.json();
                
                if (suppliersResult.success) {
                    updateSuppliersTable(suppliersResult.data);
                }
                
                // Cargar métricas
                await loadSupplierMetrics();
                
                hideLoading('suppliers');
            } catch (error) {
                console.error('Error loading suppliers data:', error);
                hideLoading('suppliers');
                showNotification('Error al cargar datos de proveedores', 'error');
            }
        }

        /**
         * Llena los selects con las constantes del módulo
         */
        function populateSupplierConstants(constants) {
            // Tipos de proveedores
            const typeSelects = ['supplier-type', 'supplier-type-filter'];
            typeSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    Object.entries(constants.supplier_types).forEach(([key, value]) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = value;
                        select.appendChild(option);
                    });
                }
            });
            
            // Categorías GAMP
            const gampSelects = ['supplier-gamp-category', 'gamp-category-filter'];
            gampSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    Object.entries(constants.gamp_categories).forEach(([key, value]) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = value;
                        select.appendChild(option);
                    });
                }
            });
            
            // Niveles de riesgo
            const riskSelects = ['supplier-risk-level', 'risk-level-filter'];
            riskSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    Object.entries(constants.risk_levels).forEach(([key, value]) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = value;
                        select.appendChild(option);
                    });
                }
            });
            
            // Tipos de calificación
            const qualificationSelect = document.getElementById('qualification-type');
            if (qualificationSelect) {
                Object.entries(constants.audit_types).forEach(([key, value]) => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = value;
                    qualificationSelect.appendChild(option);
                });
            }
            
            // Tipos de auditoría
            const auditSelect = document.getElementById('audit-type');
            if (auditSelect) {
                Object.entries(constants.audit_types).forEach(([key, value]) => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = value;
                    auditSelect.appendChild(option);
                });
            }
        }

        /**
         * Actualiza la tabla de proveedores
         */
        function updateSuppliersTable(suppliers) {
            const tbody = document.getElementById('suppliers-table-body');
            if (!tbody) return;
            
            if (!suppliers || suppliers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">No hay proveedores registrados</td></tr>';
                return;
            }
            
            let html = '';
            suppliers.forEach(supplier => {
                const riskClass = getRiskLevelClass(supplier.risk_level);
                const statusClass = getSupplierStatusClass(supplier.status);
                
                html += `
                    <tr onclick="selectSupplier(${supplier.id})" style="cursor: pointer;">
                        <td><strong>${supplier.supplier_code}</strong></td>
                        <td>${supplier.supplier_name}</td>
                        <td><span class="badge bg-info">${getSupplierTypeName(supplier.supplier_type)}</span></td>
                        <td><span class="badge bg-primary">${getGAMPCategoryName(supplier.gamp_category)}</span></td>
                        <td><span class="badge ${riskClass}">${getRiskLevelName(supplier.risk_level)}</span></td>
                        <td><span class="badge ${statusClass}">${getSupplierStatusName(supplier.status)}</span></td>
                        <td>${supplier.last_qualification_status ? `<span class="badge ${getQualificationStatusClass(supplier.last_qualification_status)}">${supplier.last_qualification_status}</span>` : '-'}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="event.stopPropagation(); viewSupplierDetails(${supplier.id})" title="Ver detalles">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-success" onclick="event.stopPropagation(); openStartQualificationModal(${supplier.id})" title="Nueva calificación">
                                    <i class="fas fa-certificate"></i>
                                </button>
                                <button class="btn btn-outline-warning" onclick="event.stopPropagation(); openScheduleAuditModal(${supplier.id})" title="Programar auditoría">
                                    <i class="fas fa-calendar-plus"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        /**
         * Abre el modal para registrar nuevo proveedor
         */
        function openRegisterSupplierModal() {
            const modal = new bootstrap.Modal(document.getElementById('registerSupplierModal'));
            document.getElementById('registerSupplierForm').reset();
            modal.show();
        }

        /**
         * Guarda un nuevo proveedor
         */
        async function saveNewSupplier() {
            const form = document.getElementById('registerSupplierForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const formData = {
                supplier_name: document.getElementById('supplier-name').value,
                supplier_type: document.getElementById('supplier-type').value,
                gamp_category: document.getElementById('supplier-gamp-category').value,
                risk_level: document.getElementById('supplier-risk-level').value,
                contact_person: document.getElementById('supplier-contact-person').value,
                contact_email: document.getElementById('supplier-contact-email').value,
                contact_phone: document.getElementById('supplier-contact-phone').value,
                country: document.getElementById('supplier-country').value,
                website: document.getElementById('supplier-website').value,
                registration_number: document.getElementById('supplier-registration').value,
                address: document.getElementById('supplier-address').value,
                description: document.getElementById('supplier-description').value
            };
            
            try {
                const response = await fetch('/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=suppliers&action=create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Proveedor registrado exitosamente', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('registerSupplierModal')).hide();
                    loadSuppliersData();
                } else {
                    showNotification(result.error || 'Error al registrar proveedor', 'error');
                }
            } catch (error) {
                console.error('Error saving supplier:', error);
                showNotification('Error al registrar proveedor', 'error');
            }
        }

        /**
         * Carga las métricas de proveedores
         */
        async function loadSupplierMetrics() {
            try {
                const response = await fetch('/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=suppliers&action=metrics');
                const result = await response.json();
                
                if (result.success) {
                    updateSupplierMetrics(result.data);
                }
            } catch (error) {
                console.error('Error loading supplier metrics:', error);
            }
        }

        /**
         * Actualiza las métricas de proveedores en el dashboard
         */
        function updateSupplierMetrics(metrics) {
            if (metrics.general) {
                const totalEl = document.getElementById('total-suppliers');
                const approvedEl = document.getElementById('approved-suppliers');
                const pendingEl = document.getElementById('pending-qualifications');
                const criticalEl = document.getElementById('critical-suppliers');
                
                if (totalEl) totalEl.textContent = metrics.general.total_suppliers || 0;
                if (approvedEl) approvedEl.textContent = metrics.general.approved_suppliers || 0;
                if (pendingEl) pendingEl.textContent = metrics.general.pending_qualification || 0;
                if (criticalEl) criticalEl.textContent = metrics.general.critical_risk_suppliers || 0;
            }
            
            // Actualizar gráficos
            updateSupplierCharts(metrics);
        }

        /**
         * Actualiza los gráficos de proveedores
         */
        function updateSupplierCharts(metrics) {
            // Gráfico por tipo de proveedor
            if (metrics.by_type) {
                updateSupplierTypeChart(metrics.by_type);
            }
            
            // Gráfico por categoría GAMP
            if (metrics.by_gamp_category) {
                updateGAMPCategoryChart(metrics.by_gamp_category);
            }
        }

        // Funciones de utilidad para proveedores
        function getRiskLevelClass(level) {
            switch (level) {
                case 'LOW': return 'bg-success';
                case 'MEDIUM': return 'bg-warning';
                case 'HIGH': return 'bg-danger';
                case 'CRITICAL': return 'bg-dark';
                default: return 'bg-secondary';
            }
        }

        function getSupplierStatusClass(status) {
            switch (status) {
                case 'APPROVED': return 'bg-success';
                case 'PENDING': return 'bg-warning';
                case 'REJECTED': return 'bg-danger';
                case 'SUSPENDED': return 'bg-dark';
                default: return 'bg-secondary';
            }
        }

        function getQualificationStatusClass(status) {
            switch (status) {
                case 'APPROVED': return 'bg-success';
                case 'CONDITIONALLY_APPROVED': return 'bg-warning';
                case 'IN_PROGRESS': return 'bg-primary';
                case 'REJECTED': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }

        function getSupplierTypeName(type) {
            const types = {
                'SOFTWARE_VENDOR': 'Software',
                'HARDWARE_VENDOR': 'Hardware',
                'SERVICE_PROVIDER': 'Servicios',
                'CONSULTANT': 'Consultor',
                'CLOUD_PROVIDER': 'Cloud',
                'MAINTENANCE_PROVIDER': 'Mantenimiento',
                'VALIDATION_SERVICES': 'Validación',
                'TRAINING_PROVIDER': 'Capacitación'
            };
            return types[type] || type;
        }

        function getGAMPCategoryName(category) {
            return category.replace('CATEGORY_', 'Cat. ');
        }

        function getRiskLevelName(level) {
            const levels = {
                'LOW': 'Bajo',
                'MEDIUM': 'Medio',
                'HIGH': 'Alto',
                'CRITICAL': 'Crítico'
            };
            return levels[level] || level;
        }

        function getSupplierStatusName(status) {
            const statuses = {
                'PENDING': 'Pendiente',
                'APPROVED': 'Aprobado',
                'REJECTED': 'Rechazado',
                'SUSPENDED': 'Suspendido',
                'EXPIRED': 'Expirado'
            };
            return statuses[status] || status;
        }

        /**
         * Filtra proveedores según los criterios seleccionados
         */
        async function filterSuppliers() {
            const supplierType = document.getElementById('supplier-type-filter').value;
            const gampCategory = document.getElementById('gamp-category-filter').value;
            const riskLevel = document.getElementById('risk-level-filter').value;
            
            const params = new URLSearchParams();
            if (supplierType) params.append('supplier_type', supplierType);
            if (gampCategory) params.append('gamp_category', gampCategory);
            if (riskLevel) params.append('risk_level', riskLevel);
            
            try {
                const response = await fetch(`/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=suppliers&action=list&${params.toString()}`);
                const result = await response.json();
                
                if (result.success) {
                    updateSuppliersTable(result.data);
                }
            } catch (error) {
                console.error('Error filtering suppliers:', error);
            }
        }

        /**
         * Busca proveedores por texto
         */
        let searchTimeout;
        function searchSuppliers() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(async () => {
                const searchTerm = document.getElementById('supplier-search').value;
                
                const params = new URLSearchParams();
                if (searchTerm) params.append('search', searchTerm);
                
                try {
                    const response = await fetch(`/app/Modules/Internal/GAMP5/GAMP5Dashboard.php?module=suppliers&action=list&${params.toString()}`);
                    const result = await response.json();
                    
                    if (result.success) {
                        updateSuppliersTable(result.data);
                    }
                } catch (error) {
                    console.error('Error searching suppliers:', error);
                }
            }, 300);
        }
    </script>
</body>
</html>